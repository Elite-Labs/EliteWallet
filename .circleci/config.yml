# Couldn't automatically generate a config from your source code.
# This is a generic template to serve as a base for your custom config
# See: https://circleci.com/docs/configuration-reference
# Stacks detected: cicd:github-actions:.github/workflows
version: 2.1
jobs:
  build:
    macos:
      xcode: 15.2.0
    steps:
      - checkout
      - run:
          name: Build IPA
          command: cd ios; bundle install; bundle exec fastlane match appstore; bundle exec fastlane ios release
      - restore_cache:
          name: Restore Deps
          keys:
            - deps-cache
      - run:
          name: Build Deps
          command: ./scripts/build_deps.sh ios;
      - save_cache:
          name: Cache Deps
          key: deps-cache
          paths:
            - ew_shared_external/ios/External/sources/elite_wallet_data
      - run:
          name: Build
          command: ./scripts/build.sh --packages-only ios; .flutter/bin/flutter build ios --release --no-codesign
      - run:
          name: Build IPA
          command: cd ios; bundle init; echo "gem 'fastlane'" > Gemfile; bundle install; bundle exec fastlane ios release
      - store_artifacts:
          path: build/ios/iphoneos/Runner.app
      - store_artifacts:
          path: build/ios/iphoneos/Runner.ipa

workflows:
  build-ios:
    jobs:
      - build
